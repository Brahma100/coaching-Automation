# 2026-02-10 Update

## Overview
Summary of changes completed on 2026-02-10 for the Coaching Automation platform.

## UI Label Cleanup
- Updated dashboard nav label: "Remove Class" → "Pending Actions".

## Notification Dedup Hardening
- Added `notification_type` + `session_id` to `CommunicationLog`.
- Dedup key now: `(teacher_id, session_id, notification_type)`.
- Teacher notification suppression now per event type (e.g., `class_start`, `attendance_open`, `attendance_submitted`).
- Added migration: `20260210_0014_notification_dedup_hardening.py`.
- Added tests for dedup behavior and auto-delete edge cases.
- README updated with dedup policy.

## Post-Class Automation Engine
- Added `app/services/post_class_automation_engine.py`.
- Triggered after attendance submit and auto-close.
- Rules + actions:
  - Attendance completeness, absences, fee context, risk indicators.
  - Teacher summary notification with `session_summary` token and dedup.
  - Student attendance notifications.
  - Silent flags for UI only.
- Added `session_summary_url` to frontend routes.
- Session summary UI accepts `session_summary` tokens.
- Removed duplicate student notification from legacy post-class pipeline.
- Added tests: `tests/test_post_class_automation.py`.
- README updated with Post-Class Automation section.

## PendingAction / Inbox Automation
- Expanded `PendingAction` schema:
  - `action_type`, `teacher_id`, `session_id`, `due_at`, `resolved_at`,
    `resolution_note`, `escalation_sent_at`.
- Added migration: `20260210_0015_inbox_automation_pending_actions.py`.
- Added `app/services/inbox_automation.py`:
  - Creates actions: `review_session_summary`, `follow_up_absentee`,
    `follow_up_fee_due`, `attendance_missed`, `homework_not_reviewed`.
  - Escalates overdue actions via Telegram once, respects quiet hours.
  - Resolves review actions on summary open, fee actions on payment.
- Integrated with Post-Class Automation to create review/absentee/fee actions.
- Updated auto-close to create `attendance_missed` actions.
- Added new inbox API:
  - `GET /api/inbox/actions`
  - `POST /api/inbox/actions/{id}/resolve`
- Added scheduler job: `inbox_escalation_job` every 10 minutes.
- Updated daily teacher brief pending action query to include teacher_id/session_id.
- Added tests: `tests/test_inbox_automation.py`.
- README updated with Inbox Automation section.

## Today View Dashboard
- Added action-centric Today View backend service + endpoint:
  - `app/services/dashboard_today_service.py`
  - `GET /api/dashboard/today`
- Today View sections: overdue, due today, today’s classes, key flags, completed today.
- Added caching (45s TTL) for dashboard payload.
- Added React Today View page at `/today` and navigation item.
- Added admin teacher filter input (teacher_id).
- Added tests: `tests/test_today_view.py`.
- README updated with Today View philosophy.

## Student Automation Layer
- Added student automation engine + digest service:
  - `app/services/student_automation_engine.py`
  - `app/services/student_digest_service.py`
- Attendance feedback now routed through student automation (dedup + daily limit).
- Homework assigned and due-tomorrow reminders (nightly job).
- Daily student digest job (nightly, sends only if changes).
- Weekly motivation job (positive-only).
- Risk soft-warnings on HIGH risk transitions.
- Student preferences (daily digest, homework reminders, motivation messages).
- API: `GET/PUT /api/student/preferences`
- Student UI: preferences form on `/ui/student/dashboard`.
- Migration: `20260210_0016_student_preferences`.
- Tests: `tests/test_student_automation.py`.

## Migrations Needed
- Run: `python -m alembic upgrade head` (adds inbox automation fields to `pending_actions`).

## Token + Summary Behavior
- Session summary tokens now use action type `session_summary`.
- Summary UI resolves review action on open when `teacher_id` is present in token payload.

## Tests Run
- `.\.venv\Scripts\python.exe -m pytest tests/test_notifications.py`
- `.\.venv\Scripts\python.exe -m pytest tests/test_post_class_automation.py`
- `.\.venv\Scripts\python.exe -m pytest tests/test_inbox_automation.py`

## Migrations Applied
- `20260210_0014_notification_dedup_hardening`
- `20260210_0015_inbox_automation_pending_actions`
