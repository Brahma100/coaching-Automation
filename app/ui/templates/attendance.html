{% extends "base.html" %}
{% block content %}
<h2>Attendance{% if batch_id %}: Batch {{ batch_id }}{% endif %}</h2>
{% if saved == '1' %}
  <p class="notice notice-success">Attendance submitted successfully.</p>
{% elif error == 'no-students' %}
  <p class="notice notice-error">No students found in this batch, so attendance was not submitted.</p>
{% elif error == 'invalid-payload' %}
  <p class="notice notice-error">Attendance form data was incomplete. Please reload and try again.</p>
{% elif error == 'submit-failed' %}
  <p class="notice notice-error">Attendance could not be submitted due to a server error. Check logs and retry.</p>
{% endif %}
<form method="get" action="/ui/attendance" class="form-inline">
  <label for="batch_filter">Batch</label>
  <select id="batch_filter" name="batch_id">
    {% for b in batches %}
      <option value="{{ b.id }}" {% if batch_id == b.id %}selected{% endif %}>{{ b.name }} ({{ b.id }})</option>
    {% endfor %}
  </select>
  <button type="submit">Load</button>
</form>
{% if not batch_id %}
  <p>No batches found. Create a batch first.</p>
{% else %}
{% if not rows %}
  <p>No students in this batch yet. Add students before submitting attendance.</p>
{% else %}
<form method="post" action="/ui/attendance/{{ batch_id }}">
  <table class="data-table">
    <tr><th>Student</th><th>Status</th><th>Comment</th></tr>
    {% for row in rows %}
    <tr>
      <td>
        {{ row.student_name }}
        <input type="hidden" name="student_id" value="{{ row.student_id }}" />
      </td>
      <td>
        <select name="status">
          <option value="Present" {% if row.status == 'Present' %}selected{% endif %}>Present</option>
          <option value="Absent" {% if row.status == 'Absent' %}selected{% endif %}>Absent</option>
          <option value="Late" {% if row.status == 'Late' %}selected{% endif %}>Late</option>
        </select>
      </td>
      <td><input name="comment" value="{{ row.comment }}" /></td>
    </tr>
    {% endfor %}
  </table>
  <button type="submit">Submit Attendance</button>
</form>
{% endif %}
{% endif %}
{% endblock %}
